{% function block.content() %}
<h1>Artists</h1>
<p>
  <a href="/artist/add" hx-get="/artist/add" hx-target="dialog">Add Artist…</a>
</p>
{% if pages.current > 1 and #artist_records == 0 then %}
<p>You've fallen off the end of the page counter!</p>
{% elseif #artist_records == 0 then %}
<p>No artists yet.</p>
{% else %}
<form method="POST" hx-boost="true" hx-swap="show:none">
  {% if error and type(error) == "string" then %}
  <p style="color: red">{%& error %}</p>
  {% end %}
  <span class="buttons sticky-top"
    ><input type="reset" value="Deselect All" /><button
      type="button"
      onclick="document.getElementsByName('qids[]').forEach((e) => { e.checked=true; })"
    >
      Select All</button
    ><input
      type="submit"
      name="delete"
      value="Delete"
      data-confirm-nicely /><input
      type="submit"
      name="merge"
      value="Merge"
      data-confirm-nicely
  /></span>
  <ul class="checkbox-bullets" hx-boost="true">
    {% for i = 1, #artist_records do local item = artist_records[i] %}
    <li>
      <label class="checkbox-bullet">
        <input
          type="checkbox"
          name="artist_ids[]"
          value="{%& item.artist_id %}"
        />
        <div>
          <strong
            ><a href="/artist/{%& item.artist_id %}"
              >{%& item.name %}</a
            ></strong
          >
          <p>
            {% render("components/artist_verified", {artist = item}) %}, 📇: {%&
            item.handle_count %}, 🖼️: {%& item.image_count %}
          </p>
        </div>
      </label>
    </li>
    {% end %}
  </ul>
  {% render("components/pagination_controls", { pages = pages, kind_plural =
  "artists" }) %}
</form>
<script>
document.body.addEventListener('htmx:confirm', function(evt) {
  if (evt.explicitOriginalTarget && evt.explicitOriginalTarget.matches("[data-confirm-nicely]")) {
    evt.preventDefault();
    const verb = evt.explicitOriginalTarget.value;
    const form = evt.target;
    const checkboxes = form.querySelectorAll("input[type='checkbox']:checked");
    const names = Array.from(checkboxes).map((box) => {
      return box.nextElementSibling.firstElementChild.textContent || "(error)";
    });
    const name_list = names.reduce(
      (acc, curr) => acc + "\n • " + curr,
      ""
    );
    const confirm_text = `Are you sure you want to ${verb} these ${names.length} items?${name_list}`;
    if (confirm(confirm_text)) {
      evt.detail.issueRequest();
    }
  }
});
</script>
{% end %}{% end %}{% render("layouts/main", { title = "Artists", user = user })
%}
