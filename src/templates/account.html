{% function block.content() %}
<h1>{%& user.username %}</h1>
<p>Your account stores:</p>
<ul>
  {% for i = 1, #image_stats do local row = image_stats[i] %}
  <li>{%& row.record_count %} {%& DbUtil.k.ImageKindLoopable[row.kind] %}s</li>
  {% end %}
  <li>{%& artist_count %} artists</li>
  <li>{%& tag_count %} tags</li>
  <li>{%& string.format("%.02f MB", data_size / 1024 / 1024 ) %} of data</li>
</ul>
<h1>Sessions</h1>
<form method="POST" action="/account/end-sessions">
  <div class="overflow-container">
    <table>
      <thead>
        <tr>
          <th class="txt">Session ID</th>
          <th class="txt">Created At</th>
          <th class="txt">Last Seen</th>
          <th class="txt">User Agent</th>
          <th class="num">IP Address</th>
        </tr>
      </thead>
      <tbody>
        {% for i = 1, #sessions do local session = sessions[i] %}
        <tr>
          <td class="txt">{%& session.session_id %}</td>
          <td class="txt">{%& session.created %}</td>
          <td class="txt">{%& FormatHttpDateTime(session.last_seen) %}</td>
          <td class="txt">{%& session.user_agent %}</td>
          <td class="num"><code>{%& session.ip %}</code></td>
        </tr>
        {% end %}
      </tbody>
    </table>
  </div>
  <input
    type="submit"
    name="terminate_all_sessions"
    value="Terminate All Sessions"
  />
</form>
<h1>Invite Links</h1>
<form method="POST" action="/account/invites">
  <p>
    You have {%& user.invites_available %} available.
    <input
      type="submit"
      name="make-invite"
      {%
      if
      user.invites_available
      <
      1
      then
      %}disabled
      {%
      end
      %}value="Make Invite Link"
    />
  </p>
</form>
<div class="overflow-container">
  <table>
    <thead>
      <tr>
        <th class="txt">Link</th>
        <th class="num">Used</th>
      </tr>
    </thead>
    <tbody>
      {% for i = 1, #invites do local invite = invites[i] %}
      <tr>
        <td class="txt">
          <a
            href="https://hyperphantasia.s0ph0s.dog/accept-invite/{%& invite.invite_id %}"
            >https://hyperphantasia.s0ph0s.dog/accept-invite/{%&
            invite.invite_id %}</a
          >
        </td>
        <td class="num">
          {% if invite.used == 1 then %}Yes{% else %}Not Yet{% end %}
        </td>
      </tr>
      {% end %}
    </tbody>
  </table>
</div>
<h1>Account Management</h1>
<form class="vbox" method="POST" action="/account/change-password">
  <h2>Change Password</h2>
  <label>
    Current Password:
    <input type="password" name="current" minlength="16" />
  </label>
  <label
    >New Password:
    <input type="password" name="new_password" minlength="16" />
  </label>
  <label>
    New Password (again):
    <input type="password" name="new_password_again" minlength="16" />
  </label>
  <span class="buttons">
    <input type="reset" value="Clear" />
    <input type="submit" name="change_password" value="Change" />
  </span>
</form>
<h2>Your Data</h2>
<form class="vbox" method="POST">
  <span>
    <input type="submit" name="export" value="Export Data" />
    You'll receive a zip file containing all of the data for your account, once
    the archiving job finishes. If you rename this file to .com instead of .zip
    (or mark it as executable on Linux/macOS), you can run it to open a
    stand-alone, read-only copy of this application with all your data!
  </span>
  <span>
    <input type="submit" name="delete" value="Delete Account" />
    This action is irreversible (but you will be prompted for confirmation
    first). Images saved by both you <i>and at least one other person</i> will
    not be deleted. Your data will cycle out of the backups after approximately
    30 days.
  </span>
</form>
{% end %}{% render("layouts/main", { title = "Profile", user = user }) %}
